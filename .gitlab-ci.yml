image: php:5.6

stages:
  - build

run-build:
  stage: build
  script:
    - rm -rf /builds/epartment/package
    - apt-get update
    - apt-get install -y wget unzip gzip dig
    - cd /builds/epartment/cmgroep-idin
    - tar cvf ../CMGroep_Idin.tar . --exclude=.git --exclude=dev_assets --exclude=ext-config.php
    - cd ..
    - rm -rf MagentoTarToConnect-master
    - wget https://github.com/astorm/MagentoTarToConnect/archive/master.zip
    - unzip master.zip
    - rm master.zip
    - php MagentoTarToConnect-master/magento-tar-to-connect.php ./cmgroep-idin/ext-config.php
    - mkdir -p ./cmgroep-idin/build
    - mv /builds/epartment/package/*.tgz ./cmgroep-idin/build/
    - dig git.dev.epartment.nl
  only:
    - master
  artifacts:
    paths:
      - build/*.tgz